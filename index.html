<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HASH · Minimal IDE</title>
  <!-- Prism.js for lightweight syntax highlighting (Python/Java/C/C++). CDN is fine for GitHub Pages. -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css">
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-java.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-c.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-cpp.min.js"></script>
  <style>
    :root{
      --bg:#0a0a0a; /* black */
      --panel:#121212; /* near-black */
      --accent:#1f2937; /* dark slate */
      --muted:#262626; /* divider */
      --text:#e5e7eb; /* light gray */
      --text-dim:#9ca3af; /* dim */
      --good:#16a34a; /* used subtly in hover only via opacity */
      --bad:#ef4444; /* used subtly in hover only via opacity */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);font:14px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Arial,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
    }
    a{color:inherit}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;gap:14px;padding:12px 0 16px;border-bottom:1px solid var(--muted)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:40px;height:40px}
    .title{font-weight:700;letter-spacing:.3px}
    .title small{display:block;color:var(--text-dim);font-weight:500}

    .controls{margin:16px 0;display:flex;gap:10px;flex-wrap:wrap}
    .btn, .chip{
      background:var(--panel);border:1px solid var(--muted);color:var(--text);
      padding:8px 12px;border-radius:10px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{border-color:var(--accent)}
    .icon{width:18px;height:18px;stroke-width:1.6}
    input[type="file"]{display:none}
    .search{flex:1;min-width:220px;display:flex;align-items:center;background:var(--panel);
      border:1px solid var(--muted);border-radius:10px;padding:8px 10px}
    .search input{flex:1;min-width:160px;background:transparent;border:0;color:var(--text);outline:none}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
    .card{position:relative;background:var(--panel);border:1px solid var(--muted);border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
    .card:hover{border-color:var(--accent)}
    .file-icon{width:36px;height:36px}
    .name{font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .meta{color:var(--text-dim);font-size:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .actions{display:flex;gap:6px}
    .tool{display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:8px;border:1px solid var(--muted);background:transparent;cursor:pointer}
    .tool:hover{border-color:var(--accent)}

    /* tooltips */
    [data-tip]{position:relative}
    [data-tip]:hover::after{
      content:attr(data-tip);
      position:absolute;left:50%;bottom:calc(100% + 8px);transform:translateX(-50%);
      background:var(--accent);color:var(--text);padding:6px 8px;border-radius:8px;font-size:12px;white-space:nowrap;pointer-events:none;
      border:1px solid var(--muted);opacity:.97
    }
    [data-tip]:hover::before{
      content:"";position:absolute;left:50%;bottom:100%;transform:translateX(-50%);
      border:6px solid transparent;border-top-color:var(--accent);
    }

    .empty{padding:40px;text-align:center;color:var(--text-dim);border:1px dashed var(--muted);border-radius:16px}
    .more{display:flex;justify-content:center;margin:18px 0}

    /* Editor modal */
    dialog{border:1px solid var(--muted);background:var(--panel);border-radius:16px;color:var(--text);width:min(1000px,92vw);max-height:88vh}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .modal-head{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 16px;border-bottom:1px solid var(--muted)}
    .modal-body{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px 16px}
    .modal-foot{display:flex;justify-content:space-between;gap:10px;padding:12px 16px;border-top:1px solid var(--muted)}
    .select{appearance:none;background:var(--bg);border:1px solid var(--muted);color:var(--text);padding:7px 10px;border-radius:10px}

    .editor{position:relative;height:58vh}
    textarea.code{width:100%;height:100%;background:#0b0b0b;border:1px solid var(--muted);color:var(--text);border-radius:12px;padding:12px 14px;resize:none;font:13px/1.5 ui-monospace,Consolas,Menlo,monospace;tab-size:2}
    pre.preview{margin:0;height:100%;overflow:auto;border:1px solid var(--muted);border-radius:12px;background:#0b0b0b;padding:12px}

    .pill{font-size:12px;color:var(--text-dim)}
    .fav.active .icon{fill:currentColor}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <!-- Inline SVG symbols (clean, simple). Not AI-styled. -->
  <svg width="0" height="0" style="position:absolute;opacity:0;pointer-events:none">
    <defs>
      <!-- Minimal personal logo: octagon shell + angle brackets <> to suggest code + subtle gear-teeth notches. Only black & dark accent. -->
      <symbol id="hash-logo" viewBox="0 0 64 64">
        <g stroke="currentColor" stroke-width="3" fill="none">
          <!-- Octagon shell -->
          <path d="M24 6h16l14 14v16L40 50H24L10 36V20z" />
          <!-- Code chevrons -->
          <path d="M25 24l-8 8l8 8" />
          <path d="M39 24l8 8l-8 8" />
          <!-- Subtle gear notches (four small cuts) -->
          <path d="M32 6v6M58 32h-6M32 58v-6M6 32h6" />
        </g>
      </symbol>
      <symbol id="plus" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
      <symbol id="upload" viewBox="0 0 24 24"><path d="M12 16V4m0 0l4 4m-4-4L8 8M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
      <symbol id="search" viewBox="0 0 24 24"><path d="M11 19a8 8 0 1 1 5.292-2.06L21 21" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
      <symbol id="star" viewBox="0 0 24 24"><path d="M12 17.3l-5.5 3l1.5-6.1l-4.7-4.1l6.2-.5L12 4l2.5 5.6l6.2.5l-4.7 4.1l1.5 6.1z" stroke="currentColor" stroke-width="1.6" fill="none"/></symbol>
      <symbol id="trash" viewBox="0 0 24 24"><path d="M4 7h16M9 7V5h6v2m-7 3l1 9m7-9l-1 9M6 7l1 14h10l1-14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
      <symbol id="edit" viewBox="0 0 24 24"><path d="M4 20h4l12-12a2.8 2.8 0 1 0-4-4L4 16v4z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
      <symbol id="file" viewBox="0 0 24 24"><path d="M6 3h8l4 4v14H6z M14 3v5h5" stroke="currentColor" stroke-width="1.8" fill="none"/></symbol>
      <symbol id="file-py" viewBox="0 0 24 24"><path d="M6 3h8l4 4v14H6z M14 3v5h5" stroke="currentColor" stroke-width="1.8" fill="none"/><text x="9" y="19" font-size="7" fill="currentColor" font-family="ui-monospace,monospace">py</text></symbol>
      <symbol id="file-java" viewBox="0 0 24 24"><path d="M6 3h8l4 4v14H6z M14 3v5h5" stroke="currentColor" stroke-width="1.8" fill="none"/><text x="6.5" y="19" font-size="7" fill="currentColor" font-family="ui-monospace,monospace">java</text></symbol>
      <symbol id="file-c" viewBox="0 0 24 24"><path d="M6 3h8l4 4v14H6z M14 3v5h5" stroke="currentColor" stroke-width="1.8" fill="none"/><text x="10" y="19" font-size="7" fill="currentColor" font-family="ui-monospace,monospace">c</text></symbol>
      <symbol id="file-cpp" viewBox="0 0 24 24"><path d="M6 3h8l4 4v14H6z M14 3v5h5" stroke="currentColor" stroke-width="1.8" fill="none"/><text x="8" y="19" font-size="7" fill="currentColor" font-family="ui-monospace,monospace">c++</text></symbol>
      <symbol id="x" viewBox="0 0 24 24"><path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
    </defs>
  </svg>

  <div class="wrap">
    <header>
      <svg class="logo" viewBox="0 0 64 64" aria-hidden="true"><use href="#hash-logo"/></svg>
      <div class="title">HASH · Minimal IDE<small>Black + Dark Slate Theme</small></div>
    </header>

    <div class="controls">
      <label class="btn" data-tip="파일 추가">
        <svg class="icon" viewBox="0 0 24 24"><use href="#plus"/></svg> 새 파일
        <input id="new-file" type="file" multiple>
      </label>
      <button id="create-empty" class="btn" data-tip="빈 파일">
        <svg class="icon" viewBox="0 0 24 24"><use href="#file"/></svg> 빈 파일
      </button>
      <label class="search" data-tip="이름으로 검색">
        <svg class="icon" viewBox="0 0 24 24" style="opacity:.7"><use href="#search"/></svg>
        <input id="q" placeholder="파일 검색..." />
      </label>
      <button id="toggle-fav" class="chip" data-tip="즐겨찾기만 보기"><svg class="icon" viewBox="0 0 24 24"><use href="#star"/></svg> 즐겨찾기</button>
    </div>

    <div id="grid" class="grid"></div>
    <div id="empty" class="empty hidden">아직 파일이 없어요. 우측 상단에서 파일을 추가하거나 빈 파일을 만들어 보세요.</div>
    <div id="more" class="more hidden"><button class="btn">더 보기</button></div>
  </div>

  <!-- Editor Modal -->
  <dialog id="editor">
    <form method="dialog" style="margin:0">
      <div class="modal-head">
        <div style="display:flex;align-items:center;gap:8px">
          <svg class="icon" viewBox="0 0 24 24"><use id="editor-icon" href="#file"/></svg>
          <input id="fname" style="background:transparent;border:1px solid var(--muted);border-radius:8px;padding:6px 8px;color:var(--text)" placeholder="파일명" />
          <span id="pill" class="pill"></span>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <select id="lang" class="select" aria-label="언어">
            <option value="python">Python</option>
            <option value="java">Java</option>
            <option value="c">C</option>
            <option value="cpp">C++</option>
          </select>
          <button id="close" class="tool" value="cancel" aria-label="닫기"><svg class="icon" viewBox="0 0 24 24"><use href="#x"/></svg></button>
        </div>
      </div>
      <div class="modal-body">
        <div class="editor"><textarea id="code" class="code" spellcheck="false" placeholder="여기에 코드를 작성... (Tab, 자동 괄호/들여쓰기 지원)"></textarea></div>
        <pre class="preview"><code id="hl" class="language-python"></code></pre>
      </div>
      <div class="modal-foot">
        <div style="display:flex;gap:8px">
          <button id="save" class="btn" data-tip="저장"><svg class="icon" viewBox="0 0 24 24"><use href="#edit"/></svg> 저장</button>
          <button id="fav" type="button" class="tool fav" data-tip="즐겨찾기"><svg class="icon" viewBox="0 0 24 24"><use href="#star"/></svg></button>
        </div>
        <div style="display:flex;gap:8px">
          <button id="del" type="button" class="tool" data-tip="삭제"><svg class="icon" viewBox="0 0 24 24"><use href="#trash"/></svg></button>
          <button id="done" class="btn" value="default">닫기</button>
        </div>
      </div>
    </form>
  </dialog>

  <script>
  // ---------- Persistence & Model ----------
  const STORAGE_KEY = 'hash:files:v1';
  const PAGE_SIZE = 24;
  let files = load();
  let state = { query:'', favOnly:false, page:1 };

  function load(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [] } catch { return [] }
  }
  function persist(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(files)) }

  function uid(){ return Math.random().toString(36).slice(2,10) }

  function extToLang(name){
    const m = name.toLowerCase().match(/\.([a-z0-9]+)$/); if(!m) return 'python';
    const e = m[1];
    if(e==='py') return 'python';
    if(e==='java') return 'java';
    if(e==='c') return 'c';
    if(e==='cc'||e==='cpp'||e==='cxx'||e==='hpp') return 'cpp';
    return 'python';
  }
  function langToIcon(lang){
    return lang==='python'?'#file-py':lang==='java'?'#file-java':lang==='c'?'#file-c':lang==='cpp'?'#file-cpp':'#file';
  }
  function templateFor(lang){
    switch(lang){
      case 'python': return 'def main():\n    print("Hello, HASH")\n\nif __name__ == "__main__":\n    main()\n';
      case 'java': return 'public class Main {\n    public static void main(String[] args){\n        System.out.println("Hello, HASH");\n    }\n}\n';
      case 'c': return '#include <stdio.h>\n\nint main(void){\n    printf("Hello, HASH\\n");\n    return 0;\n}\n';
      case 'cpp': return '#include <bits/stdc++.h>\nusing namespace std;\nint main(){\n    cout << "Hello, HASH\\n";\n    return 0;\n}\n';
    }
  }

  // ---------- Rendering ----------
  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  const moreWrap = document.getElementById('more');
  const moreBtn = moreWrap.querySelector('button');

  function visibleFiles(){
    let list = files;
    if(state.query){
      const q = state.query.toLowerCase();
      list = list.filter(f => f.name.toLowerCase().includes(q));
    }
    if(state.favOnly){ list = list.filter(f => f.favorite) }
    return list.sort((a,b)=>{
      if(a.favorite!==b.favorite) return a.favorite? -1 : 1;
      return (b.updated||0)-(a.updated||0);
    });
  }

  function render(){
    const list = visibleFiles();
    const take = list.slice(0, state.page * PAGE_SIZE);
    grid.innerHTML = '';
    take.forEach(f => grid.appendChild(card(f)));
    empty.classList.toggle('hidden', list.length>0);
    moreWrap.classList.toggle('hidden', take.length >= list.length);
  }

  function card(f){
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.id = f.id;
    // Tooltip shows file name
    el.setAttribute('data-tip', f.name);

    const top = document.createElement('div');
    top.className = 'row';
    const left = document.createElement('div');
    left.style.display='flex'; left.style.alignItems='center'; left.style.gap='10px';

    const ic = document.createElementNS('http://www.w3.org/2000/svg','svg');
    ic.setAttribute('class','file-icon'); ic.setAttribute('viewBox','0 0 24 24'); ic.innerHTML = `<use href="${langToIcon(f.lang)}"/>`;
    left.appendChild(ic);

    const nm = document.createElement('div');
    nm.className='name'; nm.textContent = f.name;
    left.appendChild(nm);

    const actions = document.createElement('div');
    actions.className='actions';
    const fav = actionBtn('#star','즐겨찾기'); fav.classList.toggle('active', f.favorite); fav.onclick = (e)=>{e.stopPropagation(); f.favorite=!f.favorite; f.updated=Date.now(); persist(); render();};
    const del = actionBtn('#trash','삭제'); del.onclick = (e)=>{e.stopPropagation(); removeFile(f.id)};
    actions.append(fav, del);

    top.append(left, actions);

    const meta = document.createElement('div'); meta.className='meta';
    const date = f.updated? new Date(f.updated).toLocaleString() : '-';
    meta.textContent = `${f.lang.toUpperCase()} · ${date}`;

    el.append(top, meta);

    el.onclick = ()=> openEditor(f.id);
    return el;
  }
  function actionBtn(symbol, tip){
    const b = document.createElement('button'); b.className='tool'; b.type='button'; b.setAttribute('data-tip', tip);
    const s = document.createElementNS('http://www.w3.org/2000/svg','svg'); s.setAttribute('class','icon'); s.setAttribute('viewBox','0 0 24 24'); s.innerHTML=`<use href="${symbol}"/>`;
    b.appendChild(s); return b;
  }

  function removeFile(id){
    const i = files.findIndex(x=>x.id===id);
    if(i>-1){ files.splice(i,1); persist(); render(); }
  }

  // ---------- Controls ----------
  document.getElementById('new-file').addEventListener('change', async (e)=>{
    const list = Array.from(e.target.files||[]);
    for(const f of list){
      const text = await f.text().catch(()=> '');
      const lang = extToLang(f.name);
      files.push({ id:uid(), name:f.name, lang, content:text, favorite:false, updated:Date.now() });
    }
    persist(); render(); e.target.value='';
  });

  document.getElementById('create-empty').addEventListener('click', ()=>{
    const name = `untitled-${files.length+1}.py`;
    const lang = extToLang(name);
    files.push({ id:uid(), name, lang, content:templateFor('python'), favorite:false, updated:Date.now() });
    persist(); render();
  });

  document.getElementById('q').addEventListener('input', (e)=>{ state.query = e.target.value; state.page=1; render(); });
  document.getElementById('toggle-fav').addEventListener('click', (e)=>{ state.favOnly=!state.favOnly; e.currentTarget.classList.toggle('active', state.favOnly); state.page=1; render(); });
  moreBtn.addEventListener('click', ()=>{ state.page++; render(); });

  // ---------- Editor ----------
  const dlg = document.getElementById('editor');
  const codeEl = document.getElementById('code');
  const hl = document.getElementById('hl');
  const langSel = document.getElementById('lang');
  const nameEl = document.getElementById('fname');
  const pill = document.getElementById('pill');
  const iconEl = document.getElementById('editor-icon');
  const favBtn = document.getElementById('fav');

  let currentId = null;

  function openEditor(id){
    currentId = id;
    const f = files.find(x=>x.id===id); if(!f) return;
    nameEl.value = f.name;
    langSel.value = f.lang;
    iconEl.setAttribute('href', langToIcon(f.lang));
    pill.textContent = f.lang.toUpperCase();
    favBtn.classList.toggle('active', !!f.favorite);
    codeEl.value = f.content || templateFor(f.lang);
    updatePreview();
    dlg.showModal();
  }

  function updatePreview(){
    const lang = langSel.value;
    hl.className = 'language-' + (lang==='cpp'?'cpp':lang);
    hl.textContent = codeEl.value;
    if(window.Prism) Prism.highlightElement(hl);
  }

  // Tab insert + auto pair + smart indent in <textarea>
  codeEl.addEventListener('keydown', (e)=>{
    const {selectionStart:s, selectionEnd:e2, value:val} = codeEl;
    const before = val.slice(0,s), after = val.slice(e2);

    // helper
    const set = (text, caretOffset)=>{ codeEl.value = text; codeEl.selectionStart = codeEl.selectionEnd = caretOffset; updatePreview(); e.preventDefault(); };

    // TAB -> insert two spaces (or indent selection)
    if(e.key==='Tab'){
      e.preventDefault();
      if(s!==e2){ // indent multiple lines
        const sel = val.slice(s,e2);
        const changed = sel.replace(/(^|\n)/g, '$1  ');
        const diff = changed.length - sel.length;
        codeEl.value = before + changed + after;
        codeEl.selectionStart = s; codeEl.selectionEnd = e2 + diff;
        updatePreview();
      } else {
        const text = before + '  ' + after;
        set(text, s+2);
      }
      return;
    }

    // Auto pairs
    const pairs = { '(':')', '[':']', '{':'}', '"':'"', "'":"'" };
    if(pairs[e.key]){
      const pair = pairs[e.key];
      // For { make a new indented line
      if(e.key==='{' ){
        e.preventDefault();
        const indent = currentIndent(before);
        const ins = '{\n' + indent + '  \n' + indent + '}';
        const caret = (before + '{\n' + indent + '  ').length;
        set(before + ins + after, caret);
        return;
      }
      // default simple pair
      e.preventDefault();
      set(before + e.key + pair + after, s+1);
      return;
    }

    // Enter -> keep indent, add extra indent if previous non-space is {
    if(e.key==='Enter'){
      e.preventDefault();
      const indent = currentIndent(before);
      const prevChar = before.replace(/\s+$/,'').slice(-1);
      const extra = prevChar==='{'? '  ' : '';
      const ins = '\n' + indent + extra;
      set(before + ins + after, (before + ins).length);
      return;
    }
  });

  function currentIndent(text){
    const i = text.lastIndexOf('\n');
    const line = text.slice(i+1);
    const m = line.match(/^(\s+)/); return m? m[1] : '';
  }

  codeEl.addEventListener('input', updatePreview);

  langSel.addEventListener('change', ()=>{
    const f = files.find(x=>x.id===currentId); if(!f) return;
    f.lang = langSel.value; f.updated=Date.now();
    iconEl.setAttribute('href', langToIcon(f.lang));
    pill.textContent = f.lang.toUpperCase();
    if(!f.content){ f.content = templateFor(f.lang); codeEl.value=f.content; }
    persist(); updatePreview(); render();
  });

  favBtn.addEventListener('click', ()=>{
    const f = files.find(x=>x.id===currentId); if(!f) return;
    f.favorite = !f.favorite; f.updated = Date.now();
    persist(); render(); favBtn.classList.toggle('active', f.favorite);
  });

  document.getElementById('save').addEventListener('click', (e)=>{
    e.preventDefault();
    const f = files.find(x=>x.id===currentId); if(!f) return;
    f.name = nameEl.value.trim() || f.name;
    f.lang = langSel.value;
    f.content = codeEl.value;
    f.updated = Date.now();
    persist(); render();
  });

  document.getElementById('del').addEventListener('click', ()=>{
    if(!currentId) return; removeFile(currentId); dlg.close();
  });

  document.getElementById('close').addEventListener('click', (e)=>{ e.preventDefault(); dlg.close(); });

  // ---------- Init ----------
  if(files.length===0){
    // seed with one of each for demo
    ['python','java','c','cpp'].forEach((lang,i)=>{
      files.push({ id:uid(), name:`demo-${lang}.${lang==='python'?'py':lang==='java'?'java':lang==='c'?'c':'cpp'}`, lang, content:templateFor(lang), favorite: i===0, updated:Date.now()-i*1000 });
    });
    persist();
  }
  render();
  </script>
</body>
</html>
